# Carbon Management System

ä¸€å€‹å®Œæ•´çš„ç¢³ç®¡ç†ç³»çµ±ï¼Œæ•´åˆå¾Œç«¯ API å’Œå‰ç«¯ç®¡ç†ä»‹é¢ï¼Œç”¨æ–¼ä¼æ¥­ç¢³è¶³è·¡è¿½è¹¤å’Œç®¡ç†ã€‚

## ğŸš€ å°ˆæ¡ˆç‰¹è‰²

- **å…¨ç«¯æ•´åˆ**ï¼šå¾Œç«¯ API + å‰ç«¯ç®¡ç†ä»‹é¢
- **ç¢³è¶³è·¡è¿½è¹¤**ï¼šç‡ƒæ–™æ¶ˆè€—ã€é›»åŠ›ä½¿ç”¨ã€ç¢³æ’æ”¾ä¿‚æ•¸è¨ˆç®—
- **è¨­å‚™ç®¡ç†**ï¼šè¨­å‚™ç‹€æ…‹ç›£æ§ã€ç¶­è­·è¨˜éŒ„ã€æ’ç¨‹ç®¡ç†
- **ç”¨æˆ¶æ¬Šé™**ï¼šå¤šè§’è‰²æ¬Šé™æ§åˆ¶ï¼ˆç®¡ç†å“¡ã€å¯©æ ¸å“¡ã€ä¸€èˆ¬ç”¨æˆ¶ï¼‰
- **è³‡æ–™è¦–è¦ºåŒ–**ï¼šè±å¯Œçš„åœ–è¡¨å’Œçµ±è¨ˆå ±è¡¨
- **ç¾ä»£åŒ–æŠ€è¡“æ£§**ï¼šTypeScriptã€Expressã€PostgreSQLã€SmartAdmin

## ğŸ“ å°ˆæ¡ˆçµæ§‹

```
carbon-management-system/
â”œâ”€â”€ ğŸ“ src/                          # å¾Œç«¯ API æºç¢¼
â”‚   â”œâ”€â”€ ğŸ“„ app.ts                    # Express æ‡‰ç”¨ç¨‹å¼é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ server.ts                 # ä¼ºæœå™¨å…¥å£é»
â”‚   â”œâ”€â”€ ğŸ“ config/                   # é…ç½®æª”æ¡ˆ
â”‚   â”‚   â””â”€â”€ ğŸ“„ env.ts               # ç’°å¢ƒè®Šæ•¸é…ç½®
â”‚   â”œâ”€â”€ ğŸ“ db/                       # è³‡æ–™åº«ç›¸é—œ
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ index.ts             # è³‡æ–™åº«é€£æ¥
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ schema.ts            # è³‡æ–™åº«è¡¨çµæ§‹
â”‚   â”‚   â””â”€â”€ ğŸ“ seed/                # è³‡æ–™åº«ç¨®å­è³‡æ–™
â”‚   â”œâ”€â”€ ğŸ“ middleware/               # Express ä¸­é–“ä»¶
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ auth.ts              # JWT èªè­‰ä¸­é–“ä»¶
â”‚   â”‚   â””â”€â”€ ğŸ“„ error.ts             # éŒ¯èª¤è™•ç†ä¸­é–“ä»¶
â”‚   â”œâ”€â”€ ğŸ“ routes/                   # API è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ auth.routes.ts       # èªè­‰ç›¸é—œ API
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ carbon.routes.ts     # ç¢³ç®¡ç† API
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ admin.routes.ts      # ç®¡ç†å“¡ API
â”‚   â”‚   â””â”€â”€ ğŸ“„ index.ts             # è·¯ç”±æ•´åˆ
â”‚   â”œâ”€â”€ ğŸ“ types/                    # TypeScript é¡å‹å®šç¾©
â”‚   â”‚   â””â”€â”€ ğŸ“„ express.d.ts         # Express é¡å‹æ“´å±•
â”‚   â”œâ”€â”€ ğŸ“ utils/                    # å·¥å…·å‡½æ•¸
â”‚   â”‚   â”œâ”€â”€ ğŸ“„ passwords.ts         # å¯†ç¢¼è™•ç†
â”‚   â”‚   â””â”€â”€ ğŸ“„ responses.ts         # çµ±ä¸€å›æ‡‰æ ¼å¼
â”‚   â””â”€â”€ ğŸ“ validators/               # è³‡æ–™é©—è­‰
â”‚       â”œâ”€â”€ ğŸ“„ auth.validator.ts    # èªè­‰è³‡æ–™é©—è­‰
â”‚       â””â”€â”€ ğŸ“„ carbon.validator.ts  # ç¢³è³‡æ–™é©—è­‰
â”œâ”€â”€ ğŸ“ frontend/                     # å‰ç«¯ UI (SmartAdmin)
â”‚   â”œâ”€â”€ ğŸ“ src/                      # å‰ç«¯æºç¢¼
â”‚   â”‚   â”œâ”€â”€ ğŸ“ content/             # é é¢å…§å®¹
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ page/            # å„ç¨®é é¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ page_login/  # ç™»å…¥é é¢
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ manager_dashboard/ # ç®¡ç†å“¡å„€è¡¨æ¿
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“ staff_dashboard/   # å“¡å·¥å„€è¡¨æ¿
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ boss_dashboard/    # è€é—†å„€è¡¨æ¿
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“ settings/        # è¨­å®šé é¢
â”‚   â”‚   â”œâ”€â”€ ğŸ“ js/                  # JavaScript æª”æ¡ˆ
â”‚   â”‚   â”œâ”€â”€ ğŸ“ scss/                # SCSS æ¨£å¼æª”æ¡ˆ
â”‚   â”‚   â”œâ”€â”€ ğŸ“ img/                 # åœ–ç‰‡è³‡æº
â”‚   â”‚   â””â”€â”€ ğŸ“ custom/              # è‡ªå®šç¾©è³‡æº
â”‚   â”œâ”€â”€ ğŸ“ dist/                     # å‰ç«¯å»ºç½®è¼¸å‡º
â”‚   â”œâ”€â”€ ğŸ“„ package.json             # å‰ç«¯ä¾è³´é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ gulpfile.js              # Gulp å»ºç½®é…ç½®
â”‚   â””â”€â”€ ğŸ“„ build.json               # å»ºç½®é…ç½®
â”œâ”€â”€ ğŸ“ tests/                        # æ¸¬è©¦æª”æ¡ˆ
â”‚   â””â”€â”€ ğŸ“„ auth.test.ts             # èªè­‰åŠŸèƒ½æ¸¬è©¦
â”œâ”€â”€ ğŸ“ docker/                       # Docker é…ç½®
â”‚   â”œâ”€â”€ ğŸ“„ Dockerfile               # Docker æ˜ åƒæª”é…ç½®
â”‚   â””â”€â”€ ğŸ“„ docker-compose.yml       # Docker Compose é…ç½®
â”œâ”€â”€ ğŸ“ dist/                         # å¾Œç«¯ç·¨è­¯è¼¸å‡º
â”œâ”€â”€ ğŸ“„ package.json                  # ä¸»å°ˆæ¡ˆé…ç½®
â”œâ”€â”€ ğŸ“„ tsconfig.json                 # TypeScript é…ç½®
â”œâ”€â”€ ğŸ“„ drizzle.config.ts            # Drizzle ORM é…ç½®
â”œâ”€â”€ ğŸ“„ .gitignore                    # Git å¿½ç•¥æª”æ¡ˆ
â””â”€â”€ ğŸ“„ README.md                     # å°ˆæ¡ˆèªªæ˜æ–‡ä»¶
```

## ğŸ›  æŠ€è¡“æ£§

### å¾Œç«¯æŠ€è¡“
- **Node.js** + **TypeScript** - é‹è¡Œç’°å¢ƒå’Œèªè¨€
- **Express.js** - Web æ¡†æ¶
- **PostgreSQL** - é—œè¯å¼è³‡æ–™åº«
- **Drizzle ORM** - è³‡æ–™åº« ORM
- **JWT** - èº«ä»½é©—è­‰
- **Zod** - è³‡æ–™é©—è­‰
- **bcryptjs** - å¯†ç¢¼åŠ å¯†
- **Helmet** - å®‰å…¨æ€§ä¸­é–“ä»¶
- **CORS** - è·¨åŸŸè³‡æºå…±äº«

### å‰ç«¯æŠ€è¡“
- **SmartAdmin** - ç®¡ç†ä»‹é¢æ¡†æ¶
- **Bootstrap 4** - UI æ¡†æ¶
- **jQuery** - JavaScript åº«
- **Gulp** - å»ºç½®å·¥å…·
- **SCSS** - CSS é è™•ç†å™¨
- **Handlebars** - æ¨¡æ¿å¼•æ“
- **Chart.js/ApexCharts** - åœ–è¡¨åº«
- **DataTables** - è³‡æ–™è¡¨æ ¼
- **FullCalendar** - æ—¥æ›†çµ„ä»¶

## ğŸ—„ è³‡æ–™åº«çµæ§‹

### æ ¸å¿ƒè¡¨æ ¼
- **users** - ç”¨æˆ¶è³‡æ–™ï¼ˆç®¡ç†å“¡ã€å¯©æ ¸å“¡ã€ä¸€èˆ¬ç”¨æˆ¶ï¼‰
- **devices** - è¨­å‚™è³‡æ–™ï¼ˆç‹€æ…‹ã€åç¨±ã€é–‹æ©Ÿæ™‚é–“ã€æ¯”ç‡ï¼‰
- **carbon** - ç¢³è¶³è·¡è³‡æ–™ï¼ˆç‡ƒæ–™åç¨±ã€æ¶ˆè€—é‡ã€é›»åŠ›ã€ä¿‚æ•¸ï¼‰
- **scraps** - å»¢æ–™ç®¡ç†ï¼ˆé¡å‹ã€ç‹€æ…‹ã€æ¿•åº¦ã€é‡é‡ã€é«”ç©ï¼‰
- **issues** - å•é¡Œè¿½è¹¤ï¼ˆæè¿°ã€ç™¼èµ·äººã€æŒ‡æ´¾è€…ã€ç‹€æ…‹ï¼‰
- **maintenance_records** - ç¶­è­·è¨˜éŒ„ï¼ˆå•é¡ŒIDã€ç”¨æˆ¶IDã€æè¿°ï¼‰
- **schedule** - æ’ç¨‹ç®¡ç†ï¼ˆç”¨æˆ¶IDã€è¨­å‚™IDã€æ¨™é¡Œã€æ™‚é–“ï¼‰
- **energy_record** - èƒ½æºè¨˜éŒ„ï¼ˆè¨­å‚™IDã€é¡å‹ã€æ—¥æœŸã€æ¶ˆè€—é‡ï¼‰

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒéœ€æ±‚
- Node.js 18+
- PostgreSQL 12+
- npm æˆ– yarn

### 2. å®‰è£ä¾è³´

```bash
# å®‰è£æ‰€æœ‰ä¾è³´ï¼ˆå¾Œç«¯ + å‰ç«¯ï¼‰
npm run install:all

# æˆ–åˆ†åˆ¥å®‰è£
npm install                    # å¾Œç«¯ä¾è³´
cd frontend && npm install     # å‰ç«¯ä¾è³´
```

### 3. ç’°å¢ƒé…ç½®

è¤‡è£½ `.env.example` åˆ° `.env` ä¸¦é…ç½®ï¼š

```bash
# è³‡æ–™åº«é…ç½®
DATABASE_URL=postgresql://username:password@localhost:5432/carbon_db

# JWT é…ç½®
JWT_SECRET=your-super-secret-jwt-key
JWT_EXPIRES_IN=7d

# ä¼ºæœå™¨é…ç½®
PORT=3000
NODE_ENV=development

# CORS é…ç½®
CORS_ORIGIN=http://localhost:3000
```

### 4. è³‡æ–™åº«è¨­ç½®

```bash
# æ¨é€è³‡æ–™åº« schema
npm run db:push

# å•Ÿå‹• Drizzle Studioï¼ˆå¯é¸ï¼‰
npm run db:studio
```

### 5. é–‹ç™¼æ¨¡å¼

```bash
# åŒæ™‚å•Ÿå‹•å¾Œç«¯å’Œå‰ç«¯
npm run dev:full

# æˆ–åˆ†åˆ¥å•Ÿå‹•
npm run dev              # å¾Œç«¯é–‹ç™¼ä¼ºæœå™¨ (http://localhost:3000)
npm run dev:frontend     # å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ (http://localhost:3001)
```

### 6. å»ºç½®éƒ¨ç½²

```bash
# å»ºç½®æ•´å€‹å°ˆæ¡ˆ
npm run build

# å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒ
npm run start            # å¾Œç«¯
npm run start:frontend   # å‰ç«¯
```

## ğŸ“‹ é–‹ç™¼è…³æœ¬

| è…³æœ¬ | æè¿° |
|------|------|
| `npm run dev` | å•Ÿå‹•å¾Œç«¯é–‹ç™¼ä¼ºæœå™¨ |
| `npm run dev:frontend` | å•Ÿå‹•å‰ç«¯é–‹ç™¼ä¼ºæœå™¨ |
| `npm run dev:full` | åŒæ™‚å•Ÿå‹•å‰å¾Œç«¯é–‹ç™¼ä¼ºæœå™¨ |
| `npm run build` | å»ºç½®æ•´å€‹å°ˆæ¡ˆ |
| `npm run build:backend` | å»ºç½®å¾Œç«¯ |
| `npm run build:frontend` | å»ºç½®å‰ç«¯ |
| `npm run start` | å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒå¾Œç«¯ |
| `npm run start:frontend` | å•Ÿå‹•ç”Ÿç”¢ç’°å¢ƒå‰ç«¯ |
| `npm run test` | åŸ·è¡Œæ¸¬è©¦ |
| `npm run test:watch` | ç›£è¦–æ¨¡å¼æ¸¬è©¦ |
| `npm run db:push` | æ¨é€è³‡æ–™åº« schema |
| `npm run db:studio` | å•Ÿå‹• Drizzle Studio |
| `npm run install:all` | å®‰è£æ‰€æœ‰ä¾è³´ |
| `npm run clean` | æ¸…ç†å»ºç½®æª”æ¡ˆ |
| `npm run lint` | ç¨‹å¼ç¢¼æª¢æŸ¥ |
| `npm run lint:fix` | è‡ªå‹•ä¿®å¾©ç¨‹å¼ç¢¼å•é¡Œ |

## ğŸ”Œ API ç«¯é»

### èªè­‰ API
- `POST /api/auth/register` - ç”¨æˆ¶è¨»å†Š
- `POST /api/auth/login` - ç”¨æˆ¶ç™»å…¥
- `GET /api/auth/profile` - ç²å–å€‹äººè³‡æ–™
- `POST /api/auth/logout` - ç”¨æˆ¶ç™»å‡º

### ç¢³ç®¡ç† API
- `POST /api/carbon` - å‰µå»ºç¢³è¨˜éŒ„
- `GET /api/carbon/my-data` - ç²å–ç”¨æˆ¶çš„ç¢³æ•¸æ“š
- `GET /api/carbon/:id` - ç²å–ç‰¹å®šç¢³è¨˜éŒ„
- `PUT /api/carbon/:id` - æ›´æ–°ç¢³è¨˜éŒ„
- `DELETE /api/carbon/:id` - åˆªé™¤ç¢³è¨˜éŒ„

### ç®¡ç†å“¡ API
- `GET /api/admin/all-carbon-data` - ç²å–æ‰€æœ‰ç¢³æ•¸æ“š
- `GET /api/admin/user-carbon-data/:userId` - ç²å–ç‰¹å®šç”¨æˆ¶çš„ç¢³æ•¸æ“š
- `GET /api/admin/carbon-stats` - ç²å–ç¢³çµ±è¨ˆè³‡æ–™
- `GET /api/admin/users` - ç²å–ç”¨æˆ¶åˆ—è¡¨
- `PUT /api/admin/users/:id` - æ›´æ–°ç”¨æˆ¶æ¬Šé™

## ğŸ¨ å‰ç«¯é é¢

### èªè­‰é é¢
- `/page_login` - ç™»å…¥é é¢
- `/page_register` - è¨»å†Šé é¢
- `/page_forget` - å¿˜è¨˜å¯†ç¢¼

### å„€è¡¨æ¿
- `/manager_dashboard` - ç®¡ç†å“¡å„€è¡¨æ¿
- `/staff_dashboard` - å“¡å·¥å„€è¡¨æ¿
- `/boss_dashboard` - è€é—†å„€è¡¨æ¿

### åŠŸèƒ½é é¢
- `/page_profile` - ç”¨æˆ¶è³‡æ–™
- `/page_projects` - å°ˆæ¡ˆç®¡ç†
- `/page_contacts` - è¯çµ¡äººç®¡ç†
- `/page_inbox` - è¨Šæ¯æ”¶ä»¶åŒ£
- `/page_chat` - å³æ™‚èŠå¤©

### è¨­å®šé é¢
- `/settings_theme_modes` - ä¸»é¡Œæ¨¡å¼è¨­å®š
- `/settings_skin_options` - å¤–è§€è¨­å®š
- `/settings_layout_options` - ç‰ˆé¢é…ç½®

## ğŸ³ Docker éƒ¨ç½²

### ä½¿ç”¨ Docker Compose

```bash
# å»ºç½®ä¸¦å•Ÿå‹•æœå‹™
docker-compose up -d

# æŸ¥çœ‹æ—¥èªŒ
docker-compose logs -f

# åœæ­¢æœå‹™
docker-compose down
```

### æ‰‹å‹•å»ºç½®

```bash
# å»ºç½® Docker æ˜ åƒ
docker build -t carbon-management-system .

# é‹è¡Œå®¹å™¨
docker run -p 3000:3000 carbon-management-system
```

## ğŸ§ª æ¸¬è©¦

```bash
# åŸ·è¡Œæ‰€æœ‰æ¸¬è©¦
npm test

# ç›£è¦–æ¨¡å¼
npm run test:watch

# æ¸¬è©¦è¦†è“‹ç‡
npm run test:coverage
```

## ğŸ“Š åŠŸèƒ½ç‰¹è‰²

### ç¢³è¶³è·¡ç®¡ç†
- ç‡ƒæ–™æ¶ˆè€—è¿½è¹¤
- é›»åŠ›ä½¿ç”¨ç›£æ§
- ç¢³æ’æ”¾ä¿‚æ•¸è¨ˆç®—
- æ­·å²æ•¸æ“šåˆ†æ
- è¶¨å‹¢åœ–è¡¨é¡¯ç¤º

### è¨­å‚™ç®¡ç†
- è¨­å‚™ç‹€æ…‹ç›£æ§
- ç¶­è­·è¨˜éŒ„è¿½è¹¤
- æ’ç¨‹ç®¡ç†
- å•é¡Œå›å ±ç³»çµ±
- èƒ½æºæ¶ˆè€—è¨˜éŒ„

### ç”¨æˆ¶ç®¡ç†
- å¤šè§’è‰²æ¬Šé™æ§åˆ¶
- ç”¨æˆ¶è³‡æ–™ç®¡ç†
- ç™»å…¥ç™»å‡ºåŠŸèƒ½
- å¯†ç¢¼åŠ å¯†ä¿è­·
- JWT èº«ä»½é©—è­‰

### è³‡æ–™è¦–è¦ºåŒ–
- è±å¯Œçš„åœ–è¡¨é¡å‹
- å³æ™‚æ•¸æ“šæ›´æ–°
- äº’å‹•å¼å„€è¡¨æ¿
- å ±è¡¨åŒ¯å‡ºåŠŸèƒ½
- éŸ¿æ‡‰å¼è¨­è¨ˆ

## ğŸ”’ å®‰å…¨æ€§

- **JWT èªè­‰**ï¼šå®‰å…¨çš„èº«ä»½é©—è­‰æ©Ÿåˆ¶
- **å¯†ç¢¼åŠ å¯†**ï¼šä½¿ç”¨ bcryptjs åŠ å¯†å¯†ç¢¼
- **CORS ä¿è­·**ï¼šè·¨åŸŸè³‡æºå…±äº«æ§åˆ¶
- **Helmet å®‰å…¨é ­**ï¼šé˜²æ­¢å¸¸è¦‹çš„ Web æ”»æ“Š
- **è³‡æ–™é©—è­‰**ï¼šä½¿ç”¨ Zod é€²è¡Œè¼¸å…¥é©—è­‰
- **SQL æ³¨å…¥é˜²è­·**ï¼šä½¿ç”¨ Drizzle ORM é˜²æ­¢ SQL æ³¨å…¥

## ğŸ¤ è²¢ç»æŒ‡å—

1. Fork å°ˆæ¡ˆ
2. å‰µå»ºåŠŸèƒ½åˆ†æ”¯ (`git checkout -b feature/AmazingFeature`)
3. æäº¤è®Šæ›´ (`git commit -m 'Add some AmazingFeature'`)
4. æ¨é€åˆ°åˆ†æ”¯ (`git push origin feature/AmazingFeature`)
5. é–‹å•Ÿ Pull Request

## ğŸ“ æˆæ¬Š

æ­¤å°ˆæ¡ˆæ¡ç”¨ MIT æˆæ¬Š - è©³è¦‹ [LICENSE](LICENSE) æª”æ¡ˆ

## ğŸ“ æ”¯æ´

å¦‚æœ‰å•é¡Œæˆ–å»ºè­°ï¼Œè«‹ï¼š
1. æŸ¥çœ‹ [Issues](../../issues) é é¢
2. å‰µå»ºæ–°çš„ Issue
3. è¯ç¹«é–‹ç™¼åœ˜éšŠ

---

**Carbon Management System** - è®“ç¢³è¶³è·¡ç®¡ç†è®Šå¾—ç°¡å–®é«˜æ•ˆ ğŸƒ 